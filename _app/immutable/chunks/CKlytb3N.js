import{ac as S,_ as y}from"./CEpFFJjy.js";import{e as b,u as d,w as h,d as T,a as c,g as k,c as I,T as l}from"./BjGCcj7h.js";b(c).catch(e=>{e.code=="failed-precondition"||e.code=="unimplemented"});const n=S([]),u="user-workouts",f=()=>{if(typeof window>"u")return[];const e=window.localStorage.getItem(u);return e?JSON.parse(e):[]},x=e=>{typeof window>"u"||window.localStorage.setItem(u,JSON.stringify(e))},E=async e=>(await k(I(c,"users",e,"workouts"))).docs.map(o=>o.data()),m=async(e,t)=>{const o=h(c);t.forEach(s=>{const a=T(c,"users",e,"workouts",s.name);o.set(a,s)}),await o.commit()},w=async e=>{const t=f(),o=await E(e),s=[...t];o.forEach(a=>{const i=s.findIndex(r=>r.name===a.name);if(i===-1)s.push(a);else{const r=s[i],p=a.lastModified?.toDate().getTime()||0,g=r.lastModified||0;p>g&&(s[i]=a)}}),n.set(s),await m(e,s)};d.subscribe(async e=>{e?await w(e.uid):n.set(f())});n.subscribe(e=>{x(e);const t=y(d);t&&m(t.uid,e)});const F=()=>n,L=e=>{const t=l.now();e.lastModified=t,n.update(o=>[...o,e])},M=(e,t)=>{const o=l.now();t.lastModified=o,n.update(s=>s.map(a=>a.name===e?t:a))},O=e=>{n.update(t=>t.filter(o=>o.name!==e))},W={getWorkouts:F,addWorkout:L,updateWorkout:M,deleteWorkout:O,sync:w},_=W.getWorkouts();export{_ as w};
